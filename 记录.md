# 本地安装

需要先配置好 gcc nvcc
```shell
export CUDA_HOME=/usr/local/cuda-11.3
export PATH=$CUDA_HOME/bin:$PATH
export LD_LIBRARY_PATH=$CUDA_HOME/lib:$CUDA_HOME/lib64:$LD_LIBRARY_PATH

pip install -e .
```

Compile Deformable Attention

```shell
cd projects/HIPIE/hipie/models/deformable_detr/ops
bash make.sh
cd ../../maskdino/pixel_decoder/ops
bash make.sh
cd ../../../../../../..
```

准备 BERT 预训练权重下载

```shell
mkdir -p projects/HIPIE/bert-base-uncased
cd projects/HIPIE/bert-base-uncased
wget -c https://huggingface.co/bert-base-uncased/resolve/main/config.json
wget -c https://huggingface.co/bert-base-uncased/resolve/main/vocab.txt
wget -c https://huggingface.co/bert-base-uncased/resolve/main/pytorch_model.bin
cd ../../..
```

准备 MaskDINO 预训练权重下载

```shell
mkdir -p projects/HIPIE/maskdino
cd projects/HIPIE/maskdino
wget -c https://github.com/IDEA-Research/detrex-storage/releases/download/maskdino-v0.1.0/maskdino_r50_50ep_300q_hid2048_3sd1_panoptic_pq53.0.pth
cd ../../..
```

下载训练好的权重

https://drive.google.com/drive/folders/1_kD3XILU1DC8uGn4vMGHgglDVlCl1U0W

存放于 weights/ 目录下


# Demo
发现要修改点代码，否则会出现重复注册错误

site-packages/fvcore/common/registry.py

```shell
    def _do_register(self, name: str, obj: Any) -> None:
        if name in self._obj_map:
            return
        else:
            # assert (
            #     name not in self._obj_map
            # ), "An object named '{}' was already registered in '{}' registry!".format(
            #     name, self._name
            # )
            self._obj_map[name] = obj
```


notebook: notebooks/demo_main.py 本机只能cpu 跑。cuda oom


